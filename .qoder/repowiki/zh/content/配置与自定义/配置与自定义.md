# 配置与自定义

<cite>
**本文档引用文件**  
- [constant.py](file://Agent-Trading-Arena/Stock_Main/constant.py)
- [main.py](file://Agent-Trading-Arena/Stock_Main/main.py)
- [Person.py](file://Agent-Trading-Arena/Stock_Main/Person.py)
- [Stock.py](file://Agent-Trading-Arena/Stock_Main/Stock.py)
- [behavior.py](file://Agent-Trading-Arena/Stock_Main/behavior.py)
- [persona.json](file://Agent-Trading-Arena/Stock_Main/save/init/persona.json)
- [stocks.json](file://Agent-Trading-Arena/Stock_Main/save/init/stocks.json)
- [reflect.txt](file://Agent-Trading-Arena/Stock_Main/content/our_prompt_template/reflect.txt)
- [buy_based_on_analysis.txt](file://Agent-Trading-Arena/Stock_Main/content/our_prompt_template/buy_based_on_analysis.txt)
- [gossip.txt](file://Agent-Trading-Arena/Stock_Main/content/our_prompt_template/gossip.txt)
- [stock_information.txt](file://Agent-Trading-Arena/Stock_Main/content/our_prompt_template/stock_information.txt)
- [hold_information.txt](file://Agent-Trading-Arena/Stock_Main/content/our_prompt_template/hold_information.txt)
</cite>

## 目录
1. [简介](#简介)
2. [核心配置项概览](#核心配置项概览)
3. [常量参数配置 (constant.py)](#常量参数配置-constantpy)
4. [智能体初始属性配置 (persona.json)](#智能体初始属性配置-personajson)
5. [资产配置管理 (stocks.json)](#资产配置管理-stocksjson)
6. [提示模板定制 (our_prompt_template)](#提示模板定制-our_prompt_template)
7. [典型自定义场景示例](#典型自定义场景示例)
8. [配置变更验证与影响分析](#配置变更验证与影响分析)

## 简介
本系统是一个模拟股票交易环境，允许用户通过修改核心配置文件来定制交易规则、智能体行为和市场动态。本指南将详细介绍如何通过调整`constant.py`中的常量、`persona.json`中的智能体属性、`stocks.json`中的资产信息以及`our_prompt_template`中的提示模板来扩展系统功能，实现对交易手续费率、市场波动系数、智能体风险偏好、反思频率等关键参数的全面控制。

## 核心配置项概览
系统提供了四个主要的配置入口，分别对应不同的功能层面：

| 配置文件 | 作用范围 | 配置类型 |
|---------|--------|--------|
| `constant.py` | 全局常量定义 | Python变量 |
| `main.py` (命令行参数) | 运行时系统参数 | 命令行参数 |
| `persona.json` | 智能体个体属性 | JSON数据 |
| `stocks.json` | 资产市场属性 | JSON数据 |
| `our_prompt_template/*.txt` | 智能体决策逻辑 | 文本模板 |

**配置项作用范围说明**：
- **全局常量**：影响整个模拟环境的底层行为，如股票名称列表。
- **系统参数**：控制模拟的宏观设置，如每日迭代次数、交易天数。
- **智能体属性**：定义每个智能体的个性化特征，如现金、风险偏好。
- **资产属性**：定义每只股票的基本面信息，如股息、初始价格。
- **提示模板**：直接决定智能体的决策逻辑和行为模式。

## 常量参数配置 (constant.py)

`constant.py`文件定义了系统中不可变的常量。目前该文件主要定义了`STOCK_NAMES`常量。

**可配置项**：
- `STOCK_NAMES`: 一个字符串列表，定义了系统中所有股票的名称标识符。默认值为`["0", "1", "2", "3", "4"]`。

**作用范围**：
此常量被`Person.py`中的`query_account`方法引用，用于在生成智能体持仓报告时，将内部的`stock_id`映射为可读的股票名称。修改此列表可以改变输出报告中显示的股票代号。

**Section sources**
- [constant.py](file://Agent-Trading-Arena/Stock_Main/constant.py#L1-L2)

## 智能体初始属性配置 (persona.json)

`persona.json`文件定义了所有智能体（交易员）的初始属性。每个智能体是一个JSON对象，包含以下可配置字段：

**可配置项及其作用**：
- `person_id`: 智能体的唯一ID，用于数据库索引。
- `name`: 智能体的名称，在日志和记忆中使用。
- `occupation`: 职业，可能影响其行为模式（目前主要为描述性）。
- `principle`: **核心投资策略**，这是智能体的“大脑”。它定义了智能体的总体投资原则，如`"try to maximize profit."`。此策略会在反思过程中被更新。
- `investment_duration`: 投资期限，影响长期策略。
- `daily_income_from_job`: 日薪，影响其现金流和可投资金。
- `cash`: 初始现金，决定了智能体的起始资本。
- `minimum_living_expense`: 最低生活开支，影响其每日的现金消耗。
- `reflect_frequency`: **反思频率**，一个关键的控制参数。值为0表示从不反思；值为n表示每n次迭代进行一次反思。例如，`reflect_frequency: 2`表示每2次交易迭代后进行一次反思。

**作用范围**：
这些属性在`Person.py`的`Person`类初始化时被加载。`cash`、`minimum_living_expense`和`daily_income_from_job`直接影响其财务状况；`principle`是其决策的核心依据；`reflect_frequency`则控制其学习和适应市场的节奏。

**Section sources**
- [Person.py](file://Agent-Trading-Arena/Stock_Main/Person.py#L173-L182)
- [persona.json](file://Agent-Trading-Arena/Stock_Main/save/init/persona.json#L1-L131)

## 资产配置管理 (stocks.json)

`stocks.json`文件定义了所有可交易资产的初始状态。每个股票是一个JSON对象，包含以下可配置字段：

**可配置项及其作用**：
- `stock_id`: 股票的唯一ID，用于数据库索引。
- `stock_name`: 股票的名称标识符，用于在提示模板中引用。
- `DPS` (Dividend Per Share): **每股股息**，直接影响持有该股票的智能体的每日收入。这是激励长期持有的关键参数。
- `past_stock_last_prices`: 一个包含过去10个交易日收盘价的列表。系统使用最后一个价格作为股票的初始市场价格，并影响其初始波动性。
- `quantity`: 股票的初始发行数量，影响其市场总值和流动性。

**作用范围**：
这些属性在`Stock.py`的`Stock`类初始化时被加载。`DPS`被`Person.py`中的`end_of_day`方法用于计算每日股息收入；`past_stock_last_prices`决定了股票的起始价格和历史数据，影响智能体的分析判断。

**Section sources**
- [Stock.py](file://Agent-Trading-Arena/Stock_Main/Stock.py#L28-L38)
- [stocks.json](file://Agent-Trading-Arena/Stock_Main/save/init/stocks.json#L1-L31)

## 提示模板定制 (our_prompt_template)

`our_prompt_template`目录下的文本文件是系统的核心，它们定义了智能体与大语言模型交互的提示词（Prompt），直接决定了智能体的行为逻辑。

**核心模板文件**：
- `buy_based_on_analysis.txt`: 控制智能体**买入决策**的模板。它向模型提供智能体的财务状况、可用股票信息、市场分析和当前投资策略，要求模型决定是否买入、买入哪只股票、以什么价格和数量买入。
- `reflect.txt`: 控制智能体**反思过程**的模板。在每次反思时，模型会收到关于其最新投资策略的弱点、优势分析，并被要求生成新的投资策略建议，从而更新其`principle`。
- `gossip.txt`: 控制智能体**生成流言**的模板。智能体基于前一天的信息生成可能影响市场的流言，可以是真实的也可以是虚假的，用于模拟信息传播和市场情绪。
- `stock_information.txt`: 一个子模板，用于格式化单只股票的详细信息，供其他主模板（如`buy_based_on_analysis.txt`）引用。
- `hold_information.txt`: 一个子模板，用于格式化智能体当前持仓的详细信息。

**可配置项及其作用**：
通过修改这些模板中的`Instructions`和`Task`部分，可以彻底改变智能体的决策逻辑。例如：
- 修改`buy_based_on_analysis.txt`中的`Instructions`，可以改变智能体的风险偏好（如从“追求最大利润”改为“优先保本”）。
- 修改`reflect.txt`中的`Task`，可以改变反思的深度和方向（如增加对宏观经济的考量）。

**Section sources**
- [behavior.py](file://Agent-Trading-Arena/Stock_Main/behavior.py#L82-L171)
- [reflect.txt](file://Agent-Trading-Arena/Stock_Main/content/our_prompt_template/reflect.txt#L1-L35)
- [buy_based_on_analysis.txt](file://Agent-Trading-Arena/Stock_Main/content/our_prompt_template/buy_based_on_analysis.txt#L1-L33)
- [gossip.txt](file://Agent-Trading-Arena/Stock_Main/content/our_prompt_template/gossip.txt#L1-L16)

## 典型自定义场景示例

### 场景一：构建高风险投机型智能体群
目标：创建一个以高风险、高回报为原则的智能体群体。

**配置变更**：
1.  **修改`persona.json`**:
    - 将多个智能体的`principle`改为`"aim for high-risk, high-return trades; leverage aggressively."`。
    - 将`reflect_frequency`设为`1`，使其每次交易后都进行反思，快速适应市场。
    - 提高`daily_income_from_job`，为其提供更多“赌资”。
2.  **修改`buy_based_on_analysis.txt`**:
    - 在`Instructions`中加入`- You are encouraged to use leverage and take significant risks for potential high rewards.`

### 场景二：模拟特定行业板块行情
目标：模拟一个科技股（股票A和B）行情火爆的市场。

**配置变更**：
1.  **修改`stocks.json`**:
    - 大幅提高股票A和B的`past_stock_last_prices`，使其呈现明显的上升趋势。
    - 适当降低股票C和D的价格，形成对比。
2.  **修改`gossip.txt`**:
    - 在`Instructions`中加入`- Focus your gossip on the booming technology sector, particularly stocks A and B.`，引导智能体生成利好科技股的流言。

### 场景三：调整信息传播速度
目标：研究信息不对称对市场的影响。

**配置变更**：
1.  **修改`main.py`的命令行参数**:
    - 在运行时通过`--gossip_num_max`参数控制每轮流言的最大数量。设为`0`则完全关闭流言系统，模拟信息闭塞的市场；设为一个较大的数（如`5`），则模拟信息快速传播的市场。
    - 通过`--Iterations_Daily`参数调整每日的迭代次数，次数越多，信息传播的“速度”越快。

## 配置变更验证与影响分析

### 验证方法
1.  **日志检查**：运行模拟后，检查`save/[SAVE_NAME]/debug_prompts/`目录下的生成的提示文件（如`day0_iter0_market_analysis_prompt.txt`）。这些文件是实际发送给大语言模型的完整提示，可以直观地看到您的配置（如修改后的`principle`或`stock_information`）是否被正确注入。
2.  **结果分析**：比较不同配置下生成的`persona.json`和`stocks.json`（在`save/[SAVE_NAME]/`目录下）。观察智能体的`principle`是否按预期更新，以及股票价格的波动模式是否符合预期。
3.  **数据库查询**：直接查询SQLite数据库文件（位于`save/[SAVE_NAME]/data`），检查`person`、`stock`和`memory`表中的数据，验证财务结算、交易记录和智能体记忆是否符合逻辑。

### 潜在影响范围
- **修改`constant.py`或`main.py`中的系统参数**：影响全局，所有智能体和资产都会遵循新的规则。例如，修改`--expense_ratio`会影响所有智能体的每日开支。
- **修改`persona.json`**：仅影响特定智能体的行为，是实现异质性智能体的关键。
- **修改`stocks.json`**：改变市场基本面，影响所有智能体对该资产的估值。
- **修改`our_prompt_template`**：影响所有使用该模板的智能体的决策逻辑，是改变系统行为模式最强大的方式，但需谨慎，错误的模板可能导致模型输出格式错误，使系统无法解析。