# 快速入门指南

<cite>
**本文档中引用的文件**  
- [README.md](file://README.md)
- [requirement.txt](file://requirement.txt)
- [run.sh](file://Agent-Trading-Arena/run.sh)
- [main.py](file://Agent-Trading-Arena/Stock_Main/main.py)
- [utils.py](file://Agent-Trading-Arena/Stock_Main/content/utils.py)
- [persona.json](file://Agent-Trading-Arena/Stock_Main/save/init/persona.json)
- [stocks.json](file://Agent-Trading-Arena/Stock_Main/save/init/stocks.json)
</cite>

## 目录
1. [简介](#简介)
2. [环境准备](#环境准备)
3. [依赖安装](#依赖安装)
4. [API密钥配置](#api密钥配置)
5. [运行系统](#运行系统)
6. [main.py参数说明](#mainpy参数说明)
7. [首次运行示例](#首次运行示例)
8. [常见问题排查](#常见问题排查)
9. [结论](#结论)

## 简介

Agent-Trading-Arena 是一个闭环、无先验知识的类人交易环境，旨在评估和推进具备自博弈能力的金融智能体。本指南将帮助新用户在本地环境中成功部署并运行该系统，从克隆仓库到首次成功模拟的完整流程。

**Section sources**
- [README.md](file://README.md#L1-L52)

## 环境准备

开始之前，请确保您的系统满足以下基本要求：

- **操作系统**: Windows、macOS 或 Linux
- **Python 版本**: 3.10（根据项目要求）
- **Git**: 用于克隆仓库
- **OpenAI API 账户**: 用于获取API密钥

首先，克隆项目仓库到本地：

```bash
git clone https://github.com/wekjsdvnm/Agent-Trading-Arena
cd Agent-Trading-Arena
```

**Section sources**
- [README.md](file://README.md#L20-L23)

## 依赖安装

项目依赖列在 `requirement.txt` 文件中，包含运行系统所需的所有Python库。使用pip安装这些依赖：

```bash
pip install -r requirement.txt
```

以下是主要依赖及其用途：

| 依赖库 | 版本要求 | 用途 |
|--------|----------|------|
| openai | 无 | OpenAI API客户端，用于调用LLM模型 |
| python-dotenv | 无 | 环境变量管理，从.env文件加载配置 |
| numpy | 无 | 数值计算和数组操作 |
| pandas | 无 | 数据处理和分析 |
| timeout_decorator | 无 | 函数执行超时控制 |
| matplotlib | 无 | 数据可视化 |
| mplfinance | 无 | 金融数据图表绘制 |

**Section sources**
- [requirement.txt](file://requirement.txt#L1-L8)
- [README.md](file://README.md#L24)

## API密钥配置

系统需要配置LLM（大语言模型）提供商的API密钥才能运行。目前支持OpenAI和DeepSeek两种提供商。

### 配置方法

推荐使用 `.env` 环境变量文件进行配置，而不是直接修改代码。

在项目根目录创建 `.env` 文件：

```bash
touch .env
```

编辑 `.env` 文件，添加以下内容：

```env
# LLM提供商选择: openai 或 deepseek
LLM_PROVIDER=openai

# OpenAI配置
OPENAI_API_KEY=your_openai_api_key_here
OPENAI_MODEL=gpt-4

# DeepSeek配置（如果使用DeepSeek）
# DEEPSEEK_API_KEY=your_deepseek_api_key_here
# DEEPSEEK_MODEL=deepseek-v3.2
# DEEPSEEK_BASE_URL=https://api.deepseek.com
```

### 配置说明

- **LLM_PROVIDER**: 指定使用的LLM提供商，可选 `openai` 或 `deepseek`
- **OPENAI_API_KEY**: OpenAI API密钥，从 [OpenAI平台](https://platform.openai.com/api-keys) 获取
- **OPENAI_MODEL**: 指定使用的OpenAI模型，默认为 `gpt-4`
- **DEEPSEEK_API_KEY**: DeepSeek API密钥（如果使用DeepSeek）

系统会自动在项目根目录及上三级目录中搜索 `.env` 文件并加载环境变量。

**Section sources**
- [utils.py](file://Agent-Trading-Arena/Stock_Main/content/utils.py#L5-L17)
- [README.md](file://README.md#L26-L32)

## 运行系统

系统提供了 `run.sh` 脚本用于简化启动过程。该脚本会自动设置环境变量并调用 `main.py`。

### run.sh脚本内容

```bash
#!/bin/bash

# 切换到Stock_Main目录
cd Stock_Main

# 设置环境变量（可选）
export PYTHONPATH=$(pwd)

# 运行模拟系统
python main.py \
  --Iterations_Daily 5 \
  --No_Days 10 \
  --Num_Person 12 \
  --Num_Stock 4 \
  --SAVE_NAME sim_test01 \
  --persona_name persona.json \
  --stock_name stocks.json \
  --Daily_Price_Limit 0.6 \
  --expense_ratio 0.02 \
  --Fluctuation_Constant 15.0 \
  --analysis_num 3 \
  --gossip_num_max 2 \
  --verbose
```

### 运行步骤

1. 确保已安装所有依赖并配置好API密钥
2. 在项目根目录执行运行脚本：

```bash
sh run.sh
```

脚本会：
- 切换到 `Stock_Main` 目录
- 设置 `PYTHONPATH` 环境变量
- 执行 `main.py` 并传入预设参数

**Section sources**
- [run.sh](file://Agent-Trading-Arena/run.sh#L1-L24)

## main.py参数说明

`main.py` 是系统的核心启动文件，通过命令行参数控制模拟的各种配置。

### 主要参数

| 参数 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| --Iterations_Daily | int | 3 | 每日迭代次数 |
| --No_Days | int | 3 | 交易天数 |
| --Num_Person | int | 9 | 代理（智能体）数量 |
| --Num_Stock | int | 3 | 股票数量 |
| --SAVE_NAME | str | None | 保存文件夹名称（None时使用时间戳） |
| --persona_name | str | persona.json | 代理配置文件名 |
| --stock_name | str | stocks.json | 股票配置文件名 |
| --Daily_Price_Limit | float | 0.7 | 每日价格变动限制 |
| --expense_ratio | float | 0.03 | 资本成本率 |
| --Fluctuation_Constant | float | 20.0 | 价格波动常数 |
| --analysis_num | int | 3 | 执行分析的代理数量 |
| --gossip_num_max | int | 3 | 每轮最大八卦条目数 |
| --verbose | bool | False | 是否打印调试信息 |

### 参数处理逻辑

当 `--SAVE_NAME` 未指定时，系统会自动生成基于时间戳的文件夹名称。同时，系统会自动创建保存路径，并从 `save/init/` 目录复制初始配置文件。

**Section sources**
- [main.py](file://Agent-Trading-Arena/Stock_Main/main.py#L17-L63)

## 首次运行示例

以下是完整的首次运行步骤：

### 1. 克隆仓库
```bash
git clone https://github.com/wekjsdvnm/Agent-Trading-Arena
cd Agent-Trading-Arena
```

### 2. 创建虚拟环境（推荐）
```bash
python -m venv venv
source venv/bin/activate  # Linux/macOS
# 或 venv\Scripts\activate  # Windows
```

### 3. 安装依赖
```bash
pip install -r requirement.txt
```

### 4. 配置API密钥
```bash
echo "OPENAI_API_KEY=your_actual_api_key" > .env
echo "LLM_PROVIDER=openai" >> .env
```

### 5. 运行系统
```bash
sh run.sh
```

### 6. 查看结果
运行成功后，结果将保存在 `Stock_Main/save/sim_test01/` 目录中，包含：
- `persona.json`: 代理配置
- `stocks.json`: 股票配置
- `information.json`: 模拟信息
- `debug_prompts/`: 调试用的提示词

**Section sources**
- [main.py](file://Agent-Trading-Arena/Stock_Main/main.py#L148-L150)
- [run.sh](file://Agent-Trading-Arena/run.sh#L9-L24)

## 常见问题排查

### 1. 依赖缺失错误
**问题**: `ModuleNotFoundError: No module named 'xxx'`
**解决方案**: 
- 确保已执行 `pip install -r requirement.txt`
- 检查是否在正确的Python环境中
- 尝试升级pip: `pip install --upgrade pip`

### 2. API连接失败
**问题**: `WARNING: OPENAI_API_KEY not found in environment variables!`
**解决方案**:
- 检查 `.env` 文件是否存在且格式正确
- 确认API密钥已正确复制，无多余空格
- 验证OpenAI账户是否有足够余额

### 3. 权限错误
**问题**: `Permission denied` 运行 `run.sh`
**解决方案**:
```bash
chmod +x run.sh
```

### 4. 路径错误
**问题**: `FileNotFoundError: [Errno 2] No such file or directory`
**解决方案**:
- 确保在项目根目录执行 `sh run.sh`
- 检查 `save/init/` 目录中是否存在 `persona.json` 和 `stocks.json`

### 5. 模型调用超时
**问题**: `LLM connection error: timeout`
**解决方案**:
- 检查网络连接
- 尝试降低并发请求
- 在 `.env` 中指定更稳定的API基础URL

**Section sources**
- [utils.py](file://Agent-Trading-Arena/Stock_Main/content/utils.py#L25-L26)
- [main.py](file://Agent-Trading-Arena/Stock_Main/main.py#L42-L44)

## 结论

通过本指南，您已经学会了如何在本地环境中部署和运行Agent-Trading-Arena系统。系统通过模拟多个智能体在股票市场中的交互，研究大语言模型在数值理解方面的能力。

关键要点：
- 使用 `.env` 文件安全地管理API密钥
- `run.sh` 脚本简化了启动流程
- `main.py` 提供了丰富的配置选项
- 结果自动保存在 `save/` 目录中

现在您已经准备好开始自己的交易模拟实验，可以调整参数探索不同的市场场景和智能体行为。